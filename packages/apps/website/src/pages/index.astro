---
import { Image } from "astro:assets";
import { Icon } from "@astrojs/starlight/components";
import getStarCount from "../utils/getStarCount";
import logo from "../assets/logo.svg";

const starsCount = await getStarCount();
const formattedStars =
  typeof starsCount === "number"
    ? new Intl.NumberFormat("en-US").format(starsCount)
    : "—";
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Superego</title>
  </head>
  <body>
    <header class="sticky-header">
      <div class="sticky-inner">
        <div class="sticky-brand">
          <Image
            src={logo}
            alt="Superego logo"
            class="sticky-logo"
            height={32}
          />
          <span>Superego</span>
        </div>
        <div class="sticky-actions">
          <a
            href={import.meta.env["PUBLIC_DISCORD_INVITE_URL"]}
            class="icon-link"
            aria-label="Join the Superego Discord"
          >
            <Icon name="discord" class="icon" />
          </a>
          <a
            href="https://github.com/superegodev/superego"
            class="icon-link"
            aria-label="Superego on GitHub"
          >
            <Icon name="github" class="icon" />
          </a>
          <a href="https://demo.superego.dev" class="button button-pill">
            Try the demo
          </a>
        </div>
      </div>
    </header>
    <main>
      <section class="fold">
        <section class="tagline">
          <p><u>Own</u> your data</p>
          <p><u>Build</u> your own apps</p>
          <p><u>Control</u> your AI</p>
        </section>

        <section class="hero">
          <div class="logo-container">
            <Image src={logo} alt="Superego logo" class="logo" height={180} />
            <Image
              src={logo}
              alt=""
              class="logo-glitch"
              aria-hidden="true"
              height={180}
            />
          </div>
          <h1 class="title">Superego</h1>
          <p class="subtitle">Your Digital Freedom</p>
          <div class="actions">
            <a href="https://demo.superego.dev" class="button">Try the demo</a>
            <a
              href="https://github.com/superegodev/superego/releases/latest"
              class="button"
            >
              Get the alpha
            </a>
          </div>
          <div
            class="highlights"
            aria-label="Superego highlights and positioning"
          >
            <span class="highlight-item">
              <Icon name="github" class="icon highlight-icon" />
              {formattedStars} stars
            </span>
            <span class="highlight-item">Local-first</span>
            <span class="highlight-item">AGPL-3.0</span>
          </div>
          <span class="scroll-hint">&raquo;</span>
        </section>
      </section>

      <section class="explainer">
        <h2 class="explainer-title"># What</h2>
        <p>
          Superego is an <b>open-source <i>personal</i> database</b> where you can
          store anything you want about your life. Notes, tasks, meals, expenses,
          health logs... Whatever you want–you define what goes in.
        </p>
        <p>
          Your data is stored <b>locally</b>, in a SQLite file you own and that
          you can back up and sync with Dropbox, Google Drive, or whichever
          service you already use. <b>No accounts, no middlemen.</b>
        </p>
        <p>On top of this, Superego gives you:</p>
        <ol>
          <li>
            A <b>platform for building your own personal apps</b>.
          </li>
          <li>
            An <b>AI assistant</b> to help you work with your data.
          </li>
        </ol>
        <h2 class="explainer-title"># Why</h2>
        <p>
          Today, most personal software keeps your life locked in cloud silos.
          Superego flips that model: your data stays with you, in a format you
          can inspect and move, so your tools remain portable, private, and
          future-proof.
        </p>
        <p>See it in action in this short demo:</p>
        <iframe
          src={import.meta.env["PUBLIC_DEMO_VIDEO_URL"]}
          title="Superego Demo Video"
          allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
          referrerpolicy="strict-origin-when-cross-origin"
          allowfullscreen></iframe>
      </section>
    </main>
    <script>
      const header = document.querySelector(".sticky-header");
      const scrollHint = document.querySelector(".scroll-hint");
      const toggleHeader = () => {
        header?.classList.toggle("is-visible", window.scrollY > 24);
        scrollHint?.classList.toggle("is-hidden", window.scrollY > 24);
      };
      toggleHeader();
      window.addEventListener("scroll", toggleHeader, { passive: true });
    </script>
  </body>
</html>

<style>
  :root {
    --bg: #fff;
    --fg: #111;
    --tagline: #111;
    --subtitle: #666;
    --btn-primary-bg: #111;
    --btn-primary-fg: #fff;
    --btn-secondary-bg: #eee;
    --btn-secondary-fg: #111;
    --btn-secondary-border: #ccc;
  }

  @media (prefers-color-scheme: dark) {
    :root {
      --bg: #111;
      --fg: #fff;
      --tagline: #fff;
      --subtitle: #888;
      --btn-primary-bg: #fff;
      --btn-primary-fg: #111;
      --btn-secondary-bg: #333;
      --btn-secondary-fg: #fff;
      --btn-secondary-border: #555;
    }
  }

  html,
  body {
    margin: 0;
    padding: 0;
    min-height: 100svh;
    background: var(--bg);
    color: var(--fg);
    font-family: monospace;
  }

  main {
    display: flex;
    flex-direction: column;
    align-items: center;
    max-width: 800px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  .sticky-header {
    position: fixed;
    inset-block-start: 0;
    inset-inline: 0;
    z-index: 20;
    background: color-mix(in srgb, var(--bg) 82%, transparent);
    backdrop-filter: blur(10px);
    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.08);
    transform: translateY(-120%);
    opacity: 0;
    pointer-events: none;
    transition: transform 0.2s ease, opacity 0.2s ease;
  }

  .sticky-header.is-visible {
    transform: translateY(0);
    opacity: 1;
    pointer-events: auto;
  }

  .sticky-inner {
    display: flex;
    align-items: center;
    justify-content: space-between;
    width: 100%;
    padding: 0.75rem 2.5rem;
    gap: 1rem;
  }

  .sticky-brand {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 700;
    font-size: 1.25rem;
  }

  .sticky-logo {
    width: 32px;
    height: 32px;
  }

  .sticky-actions {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
  }

  .icon-link {
    color: var(--fg);
    display: inline-flex;
    align-items: center;
    justify-content: center;
  }

  .icon {
    width: 1.5rem;
    height: 1.5rem;
  }

  .fold {
    display: flex;
    flex-direction: column;
    min-height: 100svh;
    width: 100%;
  }

  .tagline {
    flex: 1;
    display: flex;
    flex-direction: column;
    justify-content: center;
    align-items: center;
    font-size: clamp(2rem, 1rem + 4.3vw, 4rem);
    font-style: italic;
    text-align: center;
    color: var(--tagline);
  }

  .tagline p {
    margin-block: 1rem;
  }

  .tagline u {
    font-weight: 700;
    font-size: 1.1em;
  }

  .hero {
    display: flex;
    flex-direction: column;
    align-items: center;
    padding-block-end: 2rem;
  }

  .logo-container {
    position: relative;
    width: clamp(140px, 120px + 5vw, 180px);
    aspect-ratio: 1 / 1;
    margin-block-end: 1.5rem;
  }

  .logo {
    width: 100%;
    height: 100%;
  }

  .logo-glitch {
    position: absolute;
    inset: 0;
    width: 100%;
    height: 100%;
    opacity: 0.4;
    animation: glitch 10s infinite;
  }

  @keyframes glitch {
    0%,
    95% {
      display: none;
      transform: translate(0);
      filter: none;
    }
    96% {
      display: initial;
      transform: translate(-6px, 3px);
      filter: drop-shadow(4px 0 #f00) drop-shadow(-4px 0 #0ff);
    }
    97% {
      display: initial;
      transform: translate(6px, -3px);
      filter: drop-shadow(-4px 0 #f00) drop-shadow(4px 0 #0ff);
    }
    97.5% {
      display: initial;
      transform: translate(-3px, 6px);
      filter: drop-shadow(3px 0 #f00) drop-shadow(-3px 0 #0ff);
    }
    98% {
      display: initial;
      transform: translate(3px, -6px);
      filter: drop-shadow(-3px 0 #f00) drop-shadow(3px 0 #0ff);
    }
    98.5% {
      display: initial;
      transform: translate(-6px, -3px);
      filter: drop-shadow(4px 0 #f00) drop-shadow(-4px 0 #0ff);
    }
    99% {
      display: initial;
      transform: translate(6px, 3px);
      filter: drop-shadow(-4px 0 #f00) drop-shadow(4px 0 #0ff);
    }
    99%,
    100% {
      display: none;
      transform: translate(0);
      filter: none;
    }
  }

  .title {
    font-size: 3rem;
    font-weight: 700;
    margin-block-start: 1rem;
    margin-block-end: 0;
    text-align: center;
  }

  .subtitle {
    font-size: 1.75rem;
    margin-block-start: 1.5rem;
    margin-block-end: 3.5rem;
    text-align: center;
    color: var(--subtitle);
  }

  .actions {
    display: flex;
    gap: 1rem;
    flex-wrap: wrap;
    justify-content: center;
    margin-block-end: 2rem;
  }

  .button {
    display: inline-block;
    padding: 0.9rem 1.75rem;
    border-radius: 999px;
    text-decoration: none;
    background: var(--btn-primary-bg);
    color: var(--btn-primary-fg);
    font-weight: 600;
    font-size: 1rem;
    transition: opacity 0.2s;
  }

  .button:hover {
    opacity: 0.9;
  }

  .button-pill {
    font-size: 0.95rem;
    padding: 0.7rem 1.4rem;
  }

  .highlights {
    display: grid;
    grid-template-columns: repeat(3, minmax(0, 1fr));
    align-items: center;
    gap: 0.75rem;
    flex-wrap: wrap;
    justify-content: center;
    margin-block-end: 1.5rem;
    width: min(100%, 520px);
    color: var(--subtitle);
    font-size: 1rem;
  }

  .highlight-item {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    justify-content: center;
    text-align: center;
    position: relative;
    padding-inline: 0.5rem;
  }

  .highlight-item:not(:last-child)::after {
    content: "|";
    position: absolute;
    inset-inline-end: -0.5rem;
    color: var(--subtitle);
  }

  .highlight-icon {
    width: 1rem;
    height: 1rem;
  }

  .scroll-hint {
    display: block;
    font-size: 2rem;
    color: var(--subtitle);
    transform: rotate(90deg);
    transition: opacity 0.2s ease;
  }

  .scroll-hint.is-hidden {
    opacity: 0;
    pointer-events: none;
  }

  .explainer {
    margin-block: 10rem;
    font-size: 2rem;
    line-height: 2.5;
  }

  .explainer-title {
    margin-block: 0 1.5rem;
    font-size: 1.5rem;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    text-decoration: underline;
    text-decoration-thickness: 2px;
    text-underline-offset: 0.25rem;
  }

  .explainer p {
    margin-block: 4rem;
  }

  iframe {
    width: 100%;
    aspect-ratio: 720 / 405;
    border: 0;
    border-radius: 0.5rem;
  }
</style>
